<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scientific Image Processing Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .drag-over {
            border-color: #3b82f6 !important;
            background-color: #eff6ff !important;
        }
        .file-item {
            transition: all 0.2s ease;
        }
        .file-item:hover {
            background-color: #f3f4f6;
        }
        .progress-bar {
            transition: width 0.3s ease;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-slate-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- Header -->
        <header class="text-center mb-12">
            <div class="flex items-center justify-center mb-4">
                <div class="w-16 h-16 bg-gradient-to-br from-blue-600 to-blue-700 rounded-2xl flex items-center justify-center shadow-lg">
                    <i class="fa fa-image text-3xl text-white"></i>
                </div>
            </div>
            <h1 class="text-4xl font-bold text-gray-900 mb-3">Scientific Image Processing Assistant</h1>
            <p class="text-gray-600 text-lg">Convert your images between multiple formats with ease</p>
        </header>

        <!-- Main Card -->
        <div class="bg-white rounded-3xl shadow-2xl p-8 mb-8">
            <!-- Upload Area -->
            <div class="mb-8">
                <label class="block text-sm font-semibold text-gray-700 mb-3">Upload Files</label>
                <div id="drop-area" class="border-2 border-dashed border-gray-300 rounded-2xl p-12 text-center cursor-pointer transition-all duration-300 hover:border-blue-500 hover:bg-blue-50">
                    <input type="file" id="file-input" multiple accept=".pdf,.jpg,.jpeg,.png,.tif,.tiff,.svg" class="hidden">
                    <div class="w-20 h-20 bg-gradient-to-br from-blue-100 to-blue-200 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fa fa-cloud-upload text-4xl text-blue-600"></i>
                    </div>
                    <p class="text-gray-700 font-medium mb-2">Drag & drop your files here</p>
                    <p class="text-gray-500 text-sm mb-3">or click to browse</p>
                    <span class="text-xs text-gray-400 bg-gray-100 px-3 py-1 rounded-full">
                        PDF, JPG, PNG, TIFF, SVG
                    </span>
                </div>
            </div>

            <!-- Files List -->
            <div id="files-list" class="mb-8 hidden">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="font-semibold text-gray-700">Uploaded Files</h3>
                    <button id="clear-btn" class="text-sm text-red-500 hover:text-red-700 transition-colors">
                        <i class="fa fa-trash mr-1"></i> Clear All
                    </button>
                </div>
                <div id="files-container" class="space-y-3"></div>
            </div>

            <!-- Conversion Settings -->
            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-3">Convert To</label>
                    <select id="target-format" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all">
                        <option value="jpg">JPEG</option>
                        <option value="png">PNG</option>
                        <option value="pdf">PDF</option>
                        <option value="tiff">TIFF</option>
                    </select>
                </div>
                <div id="dpi-settings">
                    <label class="block text-sm font-semibold text-gray-700 mb-3">DPI (Quality)</label>
                    <div class="flex items-center gap-4">
                        <input type="range" id="dpi-slider" min="300" max="600" value="300" class="flex-1">
                        <input type="number" id="dpi-input" min="300" max="600" value="300" class="w-24 px-3 py-2 border border-gray-300 rounded-lg text-center">
                    </div>
                </div>
            </div>

            <!-- Convert Button -->
            <div class="flex gap-4">
                <button id="convert-btn" disabled class="flex-1 bg-gradient-to-r from-blue-600 to-blue-700 text-white py-4 px-6 rounded-xl font-semibold text-lg shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                    <i class="fa fa-magic mr-2"></i> Convert Images
                </button>
                <button id="cancel-btn" class="hidden bg-gray-200 text-gray-700 py-4 px-6 rounded-xl font-semibold hover:bg-gray-300 transition-colors">
                    <i class="fa fa-times mr-2"></i> Cancel
                </button>
            </div>

            <!-- Progress -->
            <div id="progress-area" class="mt-8 hidden">
                <div class="flex items-center justify-between mb-2">
                    <span id="progress-message" class="text-sm font-medium text-gray-700">Preparing...</span>
                    <span id="progress-percentage" class="text-sm font-bold text-blue-600">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3 overflow-hidden">
                    <div id="progress-fill" class="bg-gradient-to-r from-blue-500 to-blue-600 h-3 progress-bar" style="width: 0%"></div>
                </div>
            </div>

            <!-- Download Section -->
            <div id="download-section" class="mt-8 hidden">
                <h3 class="font-semibold text-gray-700 mb-4">
                    <i class="fa fa-check-circle text-green-500 mr-2"></i> Conversion Complete!
                </h3>
                <div id="download-items" class="space-y-3"></div>
            </div>
        </div>

        <!-- Features -->
        <div class="grid md:grid-cols-3 gap-6 mb-12">
            <div class="bg-white rounded-2xl p-6 shadow-lg text-center">
                <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa fa-bolt text-blue-600 text-xl"></i>
                </div>
                <h4 class="font-semibold text-gray-800 mb-2">Fast & Secure</h4>
                <p class="text-gray-600 text-sm">All processing happens in your browser, no files are uploaded to any server</p>
            </div>
            <div class="bg-white rounded-2xl p-6 shadow-lg text-center">
                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa fa-files-o text-green-600 text-xl"></i>
                </div>
                <h4 class="font-semibold text-gray-800 mb-2">Batch Processing</h4>
                <p class="text-gray-600 text-sm">Convert multiple images at once with our batch conversion feature</p>
            </div>
            <div class="bg-white rounded-2xl p-6 shadow-lg text-center">
                <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa fa-sliders text-purple-600 text-xl"></i>
                </div>
                <h4 class="font-semibold text-gray-800 mb-2">Customizable</h4>
                <p class="text-gray-600 text-sm">Adjust DPI and other settings to get the perfect output</p>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center py-8 text-gray-600">
            <div class="flex items-center justify-center gap-2 mb-2">
                <i class="fa fa-code"></i>
                <span class="font-medium">Scientific Image Processing Assistant</span>
            </div>
            <p class="text-sm">Made with <i class="fa fa-heart text-red-500"></i> for the research community</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const dropArea = document.getElementById('drop-area');
            const fileInput = document.getElementById('file-input');
            const filesList = document.getElementById('files-list');
            const filesContainer = document.getElementById('files-container');
            const convertBtn = document.getElementById('convert-btn');
            const clearBtn = document.getElementById('clear-btn');
            const cancelBtn = document.getElementById('cancel-btn');
            const progressArea = document.getElementById('progress-area');
            const progressFill = document.getElementById('progress-fill');
            const progressPercentage = document.getElementById('progress-percentage');
            const progressMessage = document.getElementById('progress-message');
            const downloadSection = document.getElementById('download-section');
            const downloadItems = document.getElementById('download-items');
            const targetFormat = document.getElementById('target-format');
            const dpiSettings = document.getElementById('dpi-settings');
            const dpiSlider = document.getElementById('dpi-slider');
            const dpiInput = document.getElementById('dpi-input');

            let uploadedFiles = [];
            let conversionInProgress = false;

            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });

            function highlight() {
                dropArea.classList.add('drag-over');
            }

            function unhighlight() {
                dropArea.classList.remove('drag-over');
            }

            dropArea.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }

            fileInput.addEventListener('change', function() {
                handleFiles(this.files);
            });

            dropArea.addEventListener('click', function() {
                fileInput.click();
            });

            function handleFiles(files) {
                const fileArray = Array.from(files);
                
                fileArray.forEach(file => {
                    if (isValidFile(file)) {
                        uploadedFiles.push(file);
                        addFileToUI(file);
                    }
                });

                if (uploadedFiles.length > 0) {
                    filesList.classList.remove('hidden');
                    convertBtn.disabled = false;
                }
            }

            function isValidFile(file) {
                const allowedExtensions = ['.pdf', '.jpg', '.jpeg', '.png', '.tif', '.tiff', '.svg'];
                const maxSize = 500 * 1024 * 1024;
                
                const extension = '.' + file.name.split('.').pop().toLowerCase();
                
                if (!allowedExtensions.includes(extension)) {
                    showNotification('error', `File type ${extension} is not supported`);
                    return false;
                }
                
                if (file.size > maxSize) {
                    showNotification('error', `File ${file.name} is too large`);
                    return false;
                }
                
                return true;
            }

            function addFileToUI(file) {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item bg-gray-50 p-4 rounded-xl border border-gray-200 flex items-center justify-between';
                fileItem.dataset.index = uploadedFiles.length - 1;
                
                const fileName = file.name.length > 40 ? file.name.substring(0, 40) + '...' : file.name;
                const fileSize = formatFileSize(file.size);
                const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
                
                fileItem.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl flex items-center justify-center text-blue-600">
                            <i class="fa ${getFileIcon(fileExtension)} text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="font-medium text-gray-800">${fileName}</p>
                            <p class="text-sm text-gray-500">${fileSize}</p>
                        </div>
                    </div>
                    <button class="text-red-500 hover:text-red-700 p-2 hover:bg-red-50 rounded-lg transition-colors" onclick="removeFile(${uploadedFiles.length - 1})">
                        <i class="fa fa-times"></i>
                    </button>
                `;
                
                filesContainer.appendChild(fileItem);
            }

            function getFileIcon(extension) {
                switch(extension) {
                    case '.pdf': return 'fa-file-pdf-o';
                    case '.jpg':
                    case '.jpeg': return 'fa-file-image-o';
                    case '.png': return 'fa-file-image-o';
                    case '.tif':
                    case '.tiff': return 'fa-file-image-o';
                    case '.svg': return 'fa-file-image-o';
                    default: return 'fa-file-o';
                }
            }

            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            window.removeFile = function(index) {
                uploadedFiles.splice(index, 1);
                updateFilesList();
            }

            function updateFilesList() {
                filesContainer.innerHTML = '';
                
                if (uploadedFiles.length === 0) {
                    filesList.classList.add('hidden');
                    convertBtn.disabled = true;
                    return;
                }
                
                uploadedFiles.forEach((file, index) => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item bg-gray-50 p-4 rounded-xl border border-gray-200 flex items-center justify-between';
                    fileItem.dataset.index = index;
                    
                    const fileName = file.name.length > 40 ? file.name.substring(0, 40) + '...' : file.name;
                    const fileSize = formatFileSize(file.size);
                    const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
                    
                    fileItem.innerHTML = `
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl flex items-center justify-center text-blue-600">
                                <i class="fa ${getFileIcon(fileExtension)} text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="font-medium text-gray-800">${fileName}</p>
                                <p class="text-sm text-gray-500">${fileSize}</p>
                            </div>
                        </div>
                        <button class="text-red-500 hover:text-red-700 p-2 hover:bg-red-50 rounded-lg transition-colors" onclick="removeFile(${index})">
                            <i class="fa fa-times"></i>
                        </button>
                    `;
                    
                    filesContainer.appendChild(fileItem);
                });
            }

            clearBtn.addEventListener('click', function() {
                uploadedFiles = [];
                filesContainer.innerHTML = '';
                filesList.classList.add('hidden');
                convertBtn.disabled = true;
                downloadSection.classList.add('hidden');
            });

            targetFormat.addEventListener('change', function() {
                if (this.value === 'jpg') {
                    dpiSettings.classList.remove('hidden');
                } else {
                    dpiSettings.classList.add('hidden');
                }
            });

            dpiSlider.addEventListener('input', function() {
                dpiInput.value = this.value;
            });

            dpiInput.addEventListener('input', function() {
                let value = parseInt(this.value);
                if (isNaN(value)) value = 300;
                if (value < 300) value = 300;
                if (value > 600) value = 600;
                this.value = value;
                dpiSlider.value = value;
            });

            convertBtn.addEventListener('click', function() {
                if (uploadedFiles.length === 0) {
                    showNotification('error', 'Please upload at least one file');
                    return;
                }

                startConversion();
            });

            async function startConversion() {
                conversionInProgress = true;
                convertBtn.disabled = true;
                clearBtn.disabled = true;
                cancelBtn.classList.remove('hidden');
                progressArea.classList.remove('hidden');
                downloadSection.classList.add('hidden');

                let convertedFiles = [];
                const totalFiles = uploadedFiles.length;

                for (let i = 0; i < uploadedFiles.length; i++) {
                    const file = uploadedFiles[i];
                    const progress = Math.round((i / totalFiles) * 100);
                    
                    progressFill.style.width = progress + '%';
                    progressPercentage.textContent = progress + '%';
                    progressMessage.textContent = `Converting: ${file.name}...`;

                    try {
                        const converted = await convertFile(file, targetFormat.value);
                        convertedFiles.push(converted);
                    } catch (error) {
                        showNotification('error', `Error converting ${file.name}: ${error.message}`);
                    }

                    await new Promise(resolve => setTimeout(resolve, 100));
                }

                progressFill.style.width = '100%';
                progressPercentage.textContent = '100%';
                progressMessage.textContent = 'Finalizing...';

                setTimeout(() => {
                    showDownloads(convertedFiles);
                }, 500);
            }

            async function convertFile(file, targetFormat) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    
                    reader.onload = async function(e) {
                        try {
                            const dataUrl = e.target.result;
                            const blob = await convertImage(dataUrl, targetFormat, file.name);
                            resolve({
                                name: file.name.replace(/\\.[^/.]+$/, '') + '.' + targetFormat,
                                blob: blob
                            });
                        } catch (error) {
                            reject(error);
                        }
                    };
                    
                    reader.onerror = function() {
                        reject(new Error('Failed to read file'));
                    };
                    
                    reader.readAsDataURL(file);
                });
            }

            async function convertImage(dataUrl, format, originalName) {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);
                        
                        let mimeType = 'image/png';
                        if (format === 'jpg' || format === 'jpeg') {
                            mimeType = 'image/jpeg';
                        } else if (format === 'png') {
                            mimeType = 'image/png';
                        } else if (format === 'webp') {
                            mimeType = 'image/webp';
                        }
                        
                        canvas.toBlob(function(blob) {
                            resolve(blob);
                        }, mimeType, 0.95);
                    };
                    img.onerror = function() {
                        const blob = dataURLtoBlob(dataUrl);
                        resolve(blob);
                    };
                    img.src = dataUrl;
                });
            }

            function dataURLtoBlob(dataurl) {
                const arr = dataurl.split(',');
                const mime = arr[0].match(/:(.*?);/)[1];
                const bstr = atob(arr[1]);
                let n = bstr.length;
                const u8arr = new Uint8Array(n);
                while (n--) {
                    u8arr[n] = bstr.charCodeAt(n);
                }
                return new Blob([u8arr], { type: mime });
            }

            function showDownloads(files) {
                conversionInProgress = false;
                convertBtn.disabled = false;
                clearBtn.disabled = false;
                cancelBtn.classList.add('hidden');
                progressArea.classList.add('hidden');
                downloadSection.classList.remove('hidden');

                downloadItems.innerHTML = '';

                files.forEach(file => {
                    const url = URL.createObjectURL(file.blob);
                    const downloadItem = document.createElement('div');
                    downloadItem.className = 'bg-gradient-to-r from-green-50 to-green-100 p-5 rounded-xl border border-green-200';
                    
                    downloadItem.innerHTML = `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-12 h-12 bg-gradient-to-br from-green-200 to-green-300 rounded-xl flex items-center justify-center text-green-600">
                                    <i class="fa fa-file-o text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="font-semibold text-gray-800">${file.name}</p>
                                    <p class="text-sm text-green-600">Converted successfully</p>
                                </div>
                            </div>
                            <a href="${url}" download="${file.name}" class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-5 py-2.5 rounded-xl font-medium transition-all shadow-lg hover:shadow-xl">
                                <i class="fa fa-download mr-2"></i> Download
                            </a>
                        </div>
                    `;
                    
                    downloadItems.appendChild(downloadItem);
                });

                showNotification('success', 'Conversion completed successfully!');
            }

            cancelBtn.addEventListener('click', function() {
                conversionInProgress = false;
                convertBtn.disabled = false;
                clearBtn.disabled = false;
                cancelBtn.classList.add('hidden');
                progressArea.classList.add('hidden');
                showNotification('info', 'Conversion cancelled');
            });

            function showNotification(type, message) {
                const notification = document.createElement('div');
                notification.className = `fixed top-6 right-6 px-6 py-4 rounded-xl shadow-2xl z-50 transition-all duration-300 transform translate-x-full opacity-0`;
                
                let bgColor, icon;
                switch(type) {
                    case 'success':
                        bgColor = 'bg-gradient-to-r from-green-500 to-green-600';
                        icon = 'fa-check-circle';
                        break;
                    case 'error':
                        bgColor = 'bg-gradient-to-r from-red-500 to-red-600';
                        icon = 'fa-exclamation-circle';
                        break;
                    case 'info':
                        bgColor = 'bg-gradient-to-r from-blue-500 to-blue-600';
                        icon = 'fa-info-circle';
                        break;
                }
                
                notification.className += ` ${bgColor} text-white`;
                notification.innerHTML = `
                    <div class="flex items-center">
                        <i class="fa ${icon} mr-3 text-xl"></i>
                        <span class="font-medium">${message}</span>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.classList.remove('translate-x-full', 'opacity-0');
                }, 100);
                
                setTimeout(() => {
                    notification.classList.add('translate-x-full', 'opacity-0');
                    setTimeout(() => {
                        if (document.body.contains(notification)) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }, 4000);
            }
        });
    </script>
</body>
</html>
